!function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(o,i,function(t){return e[t]}.bind(null,i));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";const o="ws://127.0.0.1:8080"+location.pathname,i=e=>document.getElementById(e);let a=null,l={x:0,y:0,vector:[0,0],speed:0,size:10,id:0,bullets:[],vulnerable:!1,health:3,collides:!1,nickname:""},s={},r={is:!1,sx:null,sy:null,x:null,y:null,reset(){this.sx=this.x,this.sy=this.y}},c={},d=!1,u=!1,h=0,y={},p=!1,m=!1,g=0,f=2,w=0;requestAnimationFrame=requestAnimationFrame||webkitRequestAnimationFrame||window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;const b={x:0,y:0,w:0,h:0,init(e,t){this.w=e,this.h=t},center(e,t){this.x=Z(this.x,e-Math.ceil(this.w/2)),this.y=Z(this.y,t-Math.ceil(this.h/2)),this.x<0&&(this.x=0),this.y<0&&(this.y=0),this.x+this.w>1500&&(this.x=1500-this.w),this.y+this.h>1500&&(this.y=1500-this.h)}};let S=0,k=0,x=!1,v=[],P=[];window.onload=(()=>{R.style.backgroundImage="url('./img/Mute.png')";const e=localStorage.getItem("havionick");S=localStorage.getItem("haviokills")?localStorage.getItem("haviokills"):0,k=localStorage.getItem("haviodeaths")?localStorage.getItem("haviodeaths"):0,ee(),e&&(l.nickname=e,q.value=e),b.init(B.width,B.height),y={cx:Math.floor(B.width/2),cy:Math.floor(B.height/2)},te(3),c=B.getBoundingClientRect()}),window.onunload=(()=>{localStorage.setItem("haviodeaths",k),localStorage.setItem("haviokills",S)}),window.oncontextmenu=(()=>!1),window.onwheel=(e=>{e.preventDefault()}),window.onresize=(e=>{c=B.getBoundingClientRect(),B.width=window.innerWidth,B.height=window.innerHeight,b.init(B.width,B.height)}),window.onscroll=(e=>{e.preventDefault()}),window.onerror=((e,t,n,o)=>{a&&1===a.readyState?a.send(JSON.stringify({error:`${new Date}\n${navigator.userAgent}\n\t${n}:${o}\t${e}\n\n`})):(e=>{const t=new XMLHttpRequest;t.open("POST","err="+e.toString(),!1),t.send()})(`${new Date}%0A${navigator.userAgent}%0A%09${n}:${o}%09${e}%0A%0A`)});const M=i("authoverlay"),C=()=>{i("loader").style.visibility="visible";const e=()=>{p?(M.style.animationPlayState="running",U(),A.soundtrack.play()):setTimeout(()=>{e()},500)};e()},I=Audio.prototype.play;Audio.prototype.play=function(){m||I.apply(this)};const A={die:new Audio("./sfx/Death.wav"),shoot:new Audio("./sfx/Shoot.wav"),speedup:new Audio("./sfx/Speedup.wav"),soundtrack:new Audio("./sfx/st.mp3"),heartPick:new Audio("./sfx/HeartPickup.wav"),shieldPick:new Audio("./sfx/ShieldPickup.wav"),hit:new Audio("./sfx/Hit.wav")};A.soundtrack.loop=!0,A.soundtrack.volume=.5,A.soundtrack.oncanplaythrough=(()=>{p=!0});const T=i("heartContainer"),R=i("mute"),E=i("connected"),$=i("roomId"),q=i("nick"),O=i("fullScreen");q.oninput=(e=>{localStorage.setItem("havionick",q.value),l.nickname=q.value}),q.onkeydown=(e=>{13===e.keyCode&&C()}),i("authentification").onclick=(()=>{C()}),Array.prototype.forEach.call(document.getElementsByClassName("upBtn"),e=>{e.onclick=(()=>{K(parseInt(e.id))})});let F=!1;const N=i("upgradeBtn"),D=N.children[0],L=i("upgradeMenu");Array.prototype.forEach.call(L.children,e=>{setTimeout(()=>{e.style.display="none"},300)}),N.onclick=(()=>{N.style.animationName="",(F=!F)?(Array.prototype.forEach.call(L.children,e=>{e.style.visibility="visible",e.style.display="block"}),L.style.height="260px",L.style.opacity="1",D.style.transform="rotateX(180deg)",L.addEventListener("mouseleave",()=>{setTimeout(()=>{F&&N.click()},1e3)},{once:!0})):(Array.prototype.forEach.call(L.children,e=>{e.style.visibility="hidden"}),L.style.height="0px",L.style.opacity="0",N.style.backgroundColor="orange",D.style.transform="rotateX(0deg)")}),O.onclick=(()=>{ne()});const _=i("minimap"),j=_.getContext("2d");j.fillStyle="lime",j.strokeStyle="lime";const B=i("game");B.style.animationPlayState="paused";const z=B.getContext("2d");z.imageSmoothingEnabled=!1,B.width=window.innerWidth,B.height=window.innerHeight,z.strokeStyle="yellow",z.font="10px Roboto Mono",z.textAlign="center",z.lineCap="round",B.onmousemove=(e=>{const t=e.x-c.x,n=e.y-c.y,o=[t-l.x+b.x,n-l.y+b.y],i=Math.sqrt(Math.pow(o[0],2)+Math.pow(o[1],2));a.send(JSON.stringify({vec:[...o.map(e=>e/i)]}))}),B.onmouseleave=(()=>{clearInterval(void 0),V(!1),u=!1,d=!1}),B.onmouseenter=(()=>{c=B.getBoundingClientRect()}),B.onmousedown=(e=>{e.preventDefault(),0===e.button?(u=!0,d||Q(!0)):2===e.button&&(e.preventDefault(),d=!0,u||V(!0))}),B.onmouseup=(e=>{e.preventDefault(),0===e.button?(u=!1,Q(!1),clearInterval(void 0)):2===e.button&&(d=!1,V(!1))});const J=new Image;J.src="./img/brick.png";const X=new Image;X.src="./img/shield_powerup.png";const G=new Image;G.src="./img/heart_powerup.png";const H={hit(){B.classList="",setTimeout(()=>{B.classList.add("animhit")},100),B.style.animationPlayState="running"},heal(){B.classList="",setTimeout(()=>{B.classList.add("animheal")},100),B.style.animationPlayState="running"},gameover(){B.classList="",setTimeout(()=>{B.classList.add("animgameover")},100),B.style.animationPlayState="running"},shield(){B.classList="",setTimeout(()=>{B.classList.add("animshield")},100),B.style.animationPlayState="running"}};void 0!==window.orientation&&(0!==window.orientation&&180!==window.orientation||(i("mob").style.display="inline"),document.onfullscreenchange=(()=>{i("fullScreen").hidden=document.fullscreenEnabled||document.webkitIsFullScreen}),document.body.onwebkitfullscreenchange=document.onfullscreenchange,i("authentification").onclick=(()=>{C(),i("mob").style.display="none",(()=>{m=!0;const e=i("mobSpeedup"),t=i("mobShoot");i("mute").style.display="none",e.style.display="inline",t.style.display="inline",e.ontouchstart=(()=>{V(!0)}),e.ontouchend=(()=>{V(!1)}),t.ontouchstart=(()=>{Q(!0)}),t.ontouchend=(e=>{Q(!1)}),B.ontouchstart=(e=>{e.targetTouches.length<2?(r.sx=e.changedTouches[0].clientX,r.sy=e.changedTouches[0].clientY):Q()}),B.ontouchmove=(e=>{r.is=!0,r.x=e.targetTouches[0].clientX,r.y=e.targetTouches[0].clientY,r.x,c.x,r.y,c.y;const t=[r.x-r.sx,r.y-r.sy],n=Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2));a.send(JSON.stringify({vec:[...t.map(e=>e/n)]}))}),B.ontouchend=(e=>{e.target===B&&(r.is=!1,r.reset())})})(),setTimeout(()=>{try{document.body.requestFullscreen()}catch(e){try{document.body.webkitRequestFullscreen()}catch(e){const t=document.createElement("meta");t.name="apple-mobile-web-app-capable",t.content="yes";const n=document.createElement("meta");n.name="apple-mobile-web-app-status-bar-style",n.content="black-translucent",document.head.appendChild(t),document.head.appendChild(n)}}p=!0},500)}),i("overlay").children[0].style.transform="scale(0.5) translate(-50%, -50%)",i("overlay").children[1].style.transform="scale(0.5) translate(50%, -50%)"),/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream?(i("about").style.backgroundColor="tomato",i("about").textContent="Sorry, this game is\nunavailable for your device",i("authentification").disabled="true"):i("about").textContent="left click: shoot\nright click: accelerate\nearn points and upgrade your unit\n kill players to be coolest; gl hf)";const W=e=>{switch(e){case 1:return"red";case 2:return"yellow";case 3:return"lime";case 4:return"cyan";case 5:return"blue";case 6:return"magenta"}},Y=e=>{if(e.p){const t=e.p[e.id];l.x=t[0],l.y=t[1]}if(void 0!==e.health&&(l.health=e.health,te(l.health)),void 0===e.damage){if(void 0!==e.frag&&(S++,ee()),void 0!==e.powerup)switch(e.powerup){case"heart":H.heal(),A.heartPick.play();break;case"shield":A.shieldPick.play(),H.shield()}void 0!==e.points&&(i("points").children[1].textContent=e.points,(g=e.points)>=f&&""===N.style.animationName&&!F&&(N.style.animationName="upgra")),void 0!==e.upgStats&&(w=e.upgStats[2][0],f=Math.min(...e.upgStats.map(e=>Math.pow(2,e[1]+1))),Array.prototype.forEach.call(L.children,(t,n)=>{t.children[1].textContent=e.upgStats[n][0],t.children[2].textContent=Math.pow(2,e.upgStats[n][1]+1)>=64?"MAX":Math.pow(2,e.upgStats[n][1]+1),t.style.backgroundColor=(e=>{switch(e){case 0:return"tomato";case 1:return"gold";case 2:return"lime";case 3:return"lightskyblue";case 4:return"royalblue";case 5:return"magenta"}})(e.upgStats[n][1])})),void 0!==e.nicks&&(s.nicknames=e.nicks,E.textContent=e.nicks.reduce((e,t)=>e+t[1]+"\n","")),void 0!==e.roomId&&($.textContent="room id: "+e.roomId),e.console&&console.log(e.console),"p"===e&&(h=Date.now()-h,i("ping").textContent=h),requestAnimationFrame(()=>{(e=>{if(z.clearRect(0,0,B.width,B.height),j.clearRect(0,0,_.width,_.height),j.strokeRect(0,0,_.width,_.height),z.lineWidth=1,B.style.backgroundPosition=`${-b.x}px ${-b.y}px`,v.forEach(e=>{z.drawImage(J,e.x-b.x,e.y-b.y)}),e.p){e.p.forEach(e=>{const t=l.size;let n=Math.round(e[0]),o=Math.round(e[1]);j.fillRect(n/1500*100,o/1500*100,2,2),n-=b.x,o-=b.y;const i=z.createRadialGradient(n,o,0,n,o,4*t);i.addColorStop(0,"white"),i.addColorStop(1,"transparent");const a=e[2];if(z.fillStyle=i,z.beginPath(),z.moveTo(n,o),z.arc(n,o,4*t,a-Math.PI/4,a+Math.PI/4),z.lineTo(n,o),z.fill(),z.fillStyle=W(e[3]),z.beginPath(),z.arc(n,o,t,0,2*Math.PI),z.fill(),z.strokeStyle="yellow",s.nicknames){const t=s.nicknames.findIndex(t=>t[0]===e[7]);t>-1&&z.strokeText(s.nicknames[t][1],n,o-15)}if(z.fillStyle="red",e[6].forEach(e=>{z.fillRect(e[0]-b.x-2,e[1]-b.y-2,4,4)}),!e[5]){const e=z.createRadialGradient(n,o,0,n,o,3*t);e.addColorStop(1,"chartreuse"),e.addColorStop(.5,"transparent"),z.fillStyle=e,z.beginPath(),z.arc(n,o,3*t,0,2*Math.PI),z.fill()}});{const t=l.size;z.fillStyle=W(e.p[e.id][3]);let n=e.p[e.id][0],o=e.p[e.id][1];b.center(n,o),j.fillStyle="yellow",j.fillRect(n/1500*100,o/1500*100,4,4),j.fillStyle="lime",n-=b.x,o-=b.y;const i=z.createRadialGradient(n,o,0,n,o,4*t);i.addColorStop(0,z.fillStyle),i.addColorStop(1,"transparent"),z.fillStyle=i,z.arc(n,o,4*t,0,2*Math.PI),z.fill()}}e.b&&e.b.forEach(e=>{const t=l.size;let n=Math.round(e[0]),o=Math.round(e[1]);j.fillRect(n/1500*100,o/1500*100,2,2),n-=b.x,o-=b.y;const i=z.createRadialGradient(n,o,0,n,o,4*t);i.addColorStop(0,"white"),i.addColorStop(1,"transparent");const a=e[2];if(z.fillStyle=i,z.beginPath(),z.moveTo(n,o),z.arc(n,o,4*t,a-Math.PI/4,a+Math.PI/4),z.lineTo(n,o),z.fill(),e[4]<2)switch(e[3]){case 3:z.fillStyle="lime";break;case 2:z.fillStyle="yellow";break;case 1:z.fillStyle="red"}else z.fillStyle="white";if(z.beginPath(),z.arc(n,o,t,0,2*Math.PI),z.fill(),z.strokeStyle="yellow",s.nicknames){const t=s.nicknames.findIndex(t=>t[0]===e[7]);t>-1&&z.strokeText(s.nicknames[t][1],n,o-15)}if(z.fillStyle="red",e[6].forEach(e=>{z.fillRect(e[0]-b.x-2,e[1]-b.y-2,4,4)}),!e[5]){const e=z.createRadialGradient(n,o,0,n,o,3*t);e.addColorStop(1,"chartreuse"),e.addColorStop(.5,"transparent"),z.fillStyle=e,z.beginPath(),z.arc(n,o,3*t,0,2*Math.PI),z.fill()}}),e.walls&&(v=e.walls),e.powerups&&(P=e.powerups),P.forEach((e,t)=>{const n=e.x,o=e.y;"shield"===e.type?z.drawImage(X,n-b.x,o-b.y):"heart"===e.type&&z.drawImage(G,n-b.x,o-b.y)}),z.strokeStyle="red",z.beginPath(),z.moveTo(-b.x,-b.y),z.lineTo(1500-b.x,-b.y),z.lineTo(1500-b.x,1500-b.y),z.lineTo(-b.x,1500-b.y),z.lineTo(-b.x,-b.y),z.stroke(),r.is&&(z.strokeStyle="rgba(50, 255, 0, 0.4)",z.beginPath(),z.lineWidth=30,z.lineCap="round",z.moveTo(r.sx,r.sy),z.lineTo(r.x,r.y),z.stroke())})(e)})}else e.health<1?(k++,A.die.play(),H.gameover(),ee()):(A.hit.play(),H.hit())},U=()=>{(a=new WebSocket(o)).onmessage=(e=>{const t=JSON.parse(e.data);Y(t)}),a.onopen=(e=>{a.send(JSON.stringify({nickname:l.nickname})),setInterval(()=>{h=Date.now(),a.send('"p"')},1e3)}),a.onclose=(e=>{console.log("Connection closed. Code: "+e.code),1006===e.code&&setTimeout(()=>{U()},500)}),a.onerror=(e=>{console.warn(e)})},K=e=>{a.send(`{"upgrade":${e}}`)},Q=e=>{u&&A.shoot.play();const t=()=>{setTimeout(()=>{u&&(A.shoot.play(),t())},w)};t(),a.send(`{"shoot":${e?1:0}}`)},V=e=>{e?A.speedup.play():(A.speedup.pause(),A.speedup.currentTime=0),l.speed=Number(e),a.send(JSON.stringify({speedup:e}))},Z=(e,t)=>e+.2*(t-e),ee=()=>{i("kills").textContent=`kills: ${S||0}`,i("deaths").textContent=`deaths: ${k||0}`},te=e=>{Array.prototype.forEach.call(T.children,e=>{e.style.display="none"});let t=0;for(;t<e;)T.children[t].style.display="inline",t++},ne=()=>{document.body.webkitRequestFullScreen()};(()=>{if(x){R.style.backgroundImage="url('./img/Mute.png')",x=!1;for(const e in A)A[e].muted=!1}else{R.style.backgroundImage='url("./img/Unmute.png")',x=!0;for(const e in A)A[e].muted=!0}})(),q.focus()}]);