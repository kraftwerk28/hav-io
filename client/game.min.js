!function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(o,i,function(t){return e[t]}.bind(null,i));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";location.pathname;const o=e=>document.getElementById(e);let i=null,a={x:0,y:0,vector:[0,0],speed:0,size:10,id:0,bullets:[],vulnerable:!1,health:3,collides:!1,nickname:""},l={},s={is:!1,sx:null,sy:null,x:null,y:null,reset(){this.sx=this.x,this.sy=this.y}},r={},c=!1,d=!1,u=0,h={},y=!1,p=!1,m=0,g=2,f=0;requestAnimationFrame=requestAnimationFrame||webkitRequestAnimationFrame||window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;const w={x:0,y:0,w:0,h:0,init(e,t){this.w=e,this.h=t},center(e,t){this.x=U(this.x,e-Math.ceil(this.w/2)),this.y=U(this.y,t-Math.ceil(this.h/2)),this.x<0&&(this.x=0),this.y<0&&(this.y=0),this.x+this.w>1500&&(this.x=1500-this.w),this.y+this.h>1500&&(this.y=1500-this.h)}};let S=0,b=0,k=[],x=[];window.onload=(()=>{A.style.backgroundImage="url('./img/Mute.png')";const e=localStorage.getItem("havionick");S=localStorage.getItem("haviokills")?localStorage.getItem("haviokills"):0,b=localStorage.getItem("haviodeaths")?localStorage.getItem("haviodeaths"):0,V(),e&&(a.nickname=e,E.value=e),w.init(_.width,_.height),h={cx:Math.floor(_.width/2),cy:Math.floor(_.height/2)},Z(3),r=_.getBoundingClientRect()}),window.onunload=(()=>{localStorage.setItem("haviodeaths",b),localStorage.setItem("haviokills",S)}),window.oncontextmenu=(()=>!1),window.onwheel=(e=>{e.preventDefault()}),window.onresize=(e=>{r=_.getBoundingClientRect(),_.width=window.innerWidth,_.height=window.innerHeight,w.init(_.width,_.height)}),window.onscroll=(e=>{e.preventDefault()}),window.onerror=((e,t,n,o)=>{i&&1===i.readyState?i.send(JSON.stringify({error:`${new Date}\n${navigator.userAgent}\n\t${n}:${o}\t${e}\n\n`})):(e=>{const t=new XMLHttpRequest;t.open("POST","err="+e.toString(),!1),t.send()})(`${new Date}%0A${navigator.userAgent}%0A%09${n}:${o}%09${e}%0A%0A`)});const v=o("authoverlay"),P=()=>{o("loader").style.visibility="visible";const e=()=>{y?(v.style.animationPlayState="running",W(),M.soundtrack.play()):setTimeout(()=>{e()},500)};e()},C=Audio.prototype.play;Audio.prototype.play=function(){p||C.apply(this)};const M={die:new Audio("./sfx/Death.wav"),shoot:new Audio("./sfx/Shoot.wav"),speedup:new Audio("./sfx/Speedup.wav"),soundtrack:new Audio("./sfx/st.mp3"),heartPick:new Audio("./sfx/HeartPickup.wav"),shieldPick:new Audio("./sfx/ShieldPickup.wav"),hit:new Audio("./sfx/Hit.wav")};M.soundtrack.loop=!0,M.soundtrack.volume=.5,M.soundtrack.oncanplaythrough=(()=>{y=!0});const I=o("heartContainer"),A=o("mute"),T=o("connected"),R=o("roomId"),E=o("nick"),$=o("fullScreen");E.oninput=(e=>{localStorage.setItem("havionick",E.value),a.nickname=E.value}),E.onkeydown=(e=>{13===e.keyCode&&P()}),o("authentification").onclick=(()=>{P()}),Array.prototype.forEach.call(document.getElementsByClassName("upBtn"),e=>{e.onclick=(()=>{Y(parseInt(e.id))})});let q=!1;const O=o("upgradeBtn"),F=O.children[0],N=o("upgradeMenu");Array.prototype.forEach.call(N.children,e=>{setTimeout(()=>{e.style.display="none"},300)}),O.onclick=(()=>{O.style.animationName="",(q=!q)?(Array.prototype.forEach.call(N.children,e=>{e.style.visibility="visible",e.style.display="block"}),N.style.height="260px",N.style.opacity="1",F.style.transform="rotateX(180deg)",N.addEventListener("mouseleave",()=>{setTimeout(()=>{q&&O.click()},1e3)},{once:!0})):(Array.prototype.forEach.call(N.children,e=>{e.style.visibility="hidden"}),N.style.height="0px",N.style.opacity="0",O.style.backgroundColor="orange",F.style.transform="rotateX(0deg)")}),$.onclick=(()=>{ee()});const D=o("minimap"),L=D.getContext("2d");L.fillStyle="lime",L.strokeStyle="lime";const _=o("game");_.style.animationPlayState="paused";const j=_.getContext("2d");j.imageSmoothingEnabled=!1,_.width=window.innerWidth,_.height=window.innerHeight,j.strokeStyle="yellow",j.font="10px Roboto Mono",j.textAlign="center",j.lineCap="round",_.onmousemove=(e=>{const t=e.x-r.x,n=e.y-r.y,o=[t-a.x+w.x,n-a.y+w.y],l=Math.sqrt(Math.pow(o[0],2)+Math.pow(o[1],2));i.send(JSON.stringify({vec:[...o.map(e=>e/l)]}))}),_.onmouseleave=(()=>{clearInterval(void 0),Q(!1),d=!1,c=!1}),_.onmouseenter=(()=>{r=_.getBoundingClientRect()}),_.onmousedown=(e=>{e.preventDefault(),0===e.button?(d=!0,c||K(!0)):2===e.button&&(e.preventDefault(),c=!0,d||Q(!0))}),_.onmouseup=(e=>{e.preventDefault(),0===e.button?(d=!1,K(!1),clearInterval(void 0)):2===e.button&&(c=!1,Q(!1))});const B=new Image;B.src="./img/brick.png";const z=new Image;z.src="./img/shield_powerup.png";const J=new Image;J.src="./img/heart_powerup.png";const X={hit(){_.classList="",setTimeout(()=>{_.classList.add("animhit")},100),_.style.animationPlayState="running"},heal(){_.classList="",setTimeout(()=>{_.classList.add("animheal")},100),_.style.animationPlayState="running"},gameover(){_.classList="",setTimeout(()=>{_.classList.add("animgameover")},100),_.style.animationPlayState="running"},shield(){_.classList="",setTimeout(()=>{_.classList.add("animshield")},100),_.style.animationPlayState="running"}};void 0!==window.orientation&&(0!==window.orientation&&180!==window.orientation||(o("mob").style.display="inline"),document.onfullscreenchange=(()=>{o("fullScreen").hidden=document.fullscreenEnabled||document.webkitIsFullScreen}),document.body.onwebkitfullscreenchange=document.onfullscreenchange,o("authentification").onclick=(()=>{P(),o("mob").style.display="none",(()=>{p=!0;const e=o("mobSpeedup"),t=o("mobShoot");o("mute").style.display="none",e.style.display="inline",t.style.display="inline",e.ontouchstart=(()=>{Q(!0)}),e.ontouchend=(()=>{Q(!1)}),t.ontouchstart=(()=>{K(!0)}),t.ontouchend=(e=>{K(!1)}),_.ontouchstart=(e=>{e.targetTouches.length<2?(s.sx=e.changedTouches[0].clientX,s.sy=e.changedTouches[0].clientY):K()}),_.ontouchmove=(e=>{s.is=!0,s.x=e.targetTouches[0].clientX,s.y=e.targetTouches[0].clientY,s.x,r.x,s.y,r.y;const t=[s.x-s.sx,s.y-s.sy],n=Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2));i.send(JSON.stringify({vec:[...t.map(e=>e/n)]}))}),_.ontouchend=(e=>{e.target===_&&(s.is=!1,s.reset())})})(),setTimeout(()=>{try{document.body.requestFullscreen()}catch(e){try{document.body.webkitRequestFullscreen()}catch(e){const t=document.createElement("meta");t.name="apple-mobile-web-app-capable",t.content="yes";const n=document.createElement("meta");n.name="apple-mobile-web-app-status-bar-style",n.content="black-translucent",document.head.appendChild(t),document.head.appendChild(n)}}y=!0},500)}),o("overlay").children[0].style.transform="scale(0.5) translate(-50%, -50%)",o("overlay").children[1].style.transform="scale(0.5) translate(50%, -50%)"),/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream?(o("about").style.backgroundColor="tomato",o("about").textContent="Sorry, this game is\nunavailable for your device",o("authentification").disabled="true"):o("about").textContent="left click: shoot\nright click: accelerate\nearn points and upgrade your unit\n kill players to be coolest; gl hf)";const G=e=>{switch(e){case 1:return"red";case 2:return"yellow";case 3:return"lime";case 4:return"cyan";case 5:return"blue";case 6:return"magenta"}},H=e=>{if(e.p){const t=e.p[e.id];a.x=t[0],a.y=t[1]}if(void 0!==e.health&&(a.health=e.health,Z(a.health)),void 0===e.damage){if(void 0!==e.frag&&(S++,V()),void 0!==e.powerup)switch(e.powerup){case"heart":X.heal(),M.heartPick.play();break;case"shield":M.shieldPick.play(),X.shield()}void 0!==e.points&&(o("points").children[1].textContent=e.points,(m=e.points)>=g&&""===O.style.animationName&&!q&&(O.style.animationName="upgra")),void 0!==e.upgStats&&(f=e.upgStats[2][0],g=Math.min(...e.upgStats.map(e=>Math.pow(2,e[1]+1))),Array.prototype.forEach.call(N.children,(t,n)=>{t.children[1].textContent=e.upgStats[n][0],t.children[2].textContent=Math.pow(2,e.upgStats[n][1]+1)>=64?"MAX":Math.pow(2,e.upgStats[n][1]+1),t.style.backgroundColor=(e=>{switch(e){case 0:return"tomato";case 1:return"gold";case 2:return"lime";case 3:return"lightskyblue";case 4:return"royalblue";case 5:return"magenta"}})(e.upgStats[n][1])})),void 0!==e.nicks&&(l.nicknames=e.nicks,T.textContent=e.nicks.reduce((e,t)=>e+t[1]+"\n","")),void 0!==e.roomId&&(R.textContent="room id: "+e.roomId),e.console&&console.log(e.console),"p"===e&&(u=Date.now()-u,o("ping").textContent=u),requestAnimationFrame(()=>{(e=>{if(j.clearRect(0,0,_.width,_.height),L.clearRect(0,0,D.width,D.height),L.strokeRect(0,0,D.width,D.height),j.lineWidth=1,_.style.backgroundPosition=`${-w.x}px ${-w.y}px`,k.forEach(e=>{j.drawImage(B,e.x-w.x,e.y-w.y)}),e.p){e.p.forEach(e=>{const t=a.size;let n=Math.round(e[0]),o=Math.round(e[1]);L.fillRect(n/1500*100,o/1500*100,2,2),n-=w.x,o-=w.y;const i=j.createRadialGradient(n,o,0,n,o,4*t);i.addColorStop(0,"white"),i.addColorStop(1,"transparent");const s=e[2];if(j.fillStyle=i,j.beginPath(),j.moveTo(n,o),j.arc(n,o,4*t,s-Math.PI/4,s+Math.PI/4),j.lineTo(n,o),j.fill(),j.fillStyle=G(e[3]),j.beginPath(),j.arc(n,o,t,0,2*Math.PI),j.fill(),j.strokeStyle="yellow",l.nicknames){const t=l.nicknames.findIndex(t=>t[0]===e[7]);t>-1&&j.strokeText(l.nicknames[t][1],n,o-15)}if(j.fillStyle="red",e[6].forEach(e=>{j.fillRect(e[0]-w.x-2,e[1]-w.y-2,4,4)}),!e[5]){const e=j.createRadialGradient(n,o,0,n,o,3*t);e.addColorStop(1,"chartreuse"),e.addColorStop(.5,"transparent"),j.fillStyle=e,j.beginPath(),j.arc(n,o,3*t,0,2*Math.PI),j.fill()}});{const t=a.size;j.fillStyle=G(e.p[e.id][3]);let n=e.p[e.id][0],o=e.p[e.id][1];w.center(n,o),L.fillStyle="yellow",L.fillRect(n/1500*100,o/1500*100,4,4),L.fillStyle="lime",n-=w.x,o-=w.y;const i=j.createRadialGradient(n,o,0,n,o,4*t);i.addColorStop(0,j.fillStyle),i.addColorStop(1,"transparent"),j.fillStyle=i,j.arc(n,o,4*t,0,2*Math.PI),j.fill()}}e.b&&e.b.forEach(e=>{const t=a.size;let n=Math.round(e[0]),o=Math.round(e[1]);L.fillRect(n/1500*100,o/1500*100,2,2),n-=w.x,o-=w.y;const i=j.createRadialGradient(n,o,0,n,o,4*t);i.addColorStop(0,"white"),i.addColorStop(1,"transparent");const s=e[2];if(j.fillStyle=i,j.beginPath(),j.moveTo(n,o),j.arc(n,o,4*t,s-Math.PI/4,s+Math.PI/4),j.lineTo(n,o),j.fill(),e[4]<2)switch(e[3]){case 3:j.fillStyle="lime";break;case 2:j.fillStyle="yellow";break;case 1:j.fillStyle="red"}else j.fillStyle="white";if(j.beginPath(),j.arc(n,o,t,0,2*Math.PI),j.fill(),j.strokeStyle="yellow",l.nicknames){const t=l.nicknames.findIndex(t=>t[0]===e[7]);t>-1&&j.strokeText(l.nicknames[t][1],n,o-15)}if(j.fillStyle="red",e[6].forEach(e=>{j.fillRect(e[0]-w.x-2,e[1]-w.y-2,4,4)}),!e[5]){const e=j.createRadialGradient(n,o,0,n,o,3*t);e.addColorStop(1,"chartreuse"),e.addColorStop(.5,"transparent"),j.fillStyle=e,j.beginPath(),j.arc(n,o,3*t,0,2*Math.PI),j.fill()}}),e.walls&&(k=e.walls),e.powerups&&(x=e.powerups),x.forEach((e,t)=>{const n=e.x,o=e.y;"shield"===e.type?j.drawImage(z,n-w.x,o-w.y):"heart"===e.type&&j.drawImage(J,n-w.x,o-w.y)}),j.strokeStyle="red",j.beginPath(),j.moveTo(-w.x,-w.y),j.lineTo(1500-w.x,-w.y),j.lineTo(1500-w.x,1500-w.y),j.lineTo(-w.x,1500-w.y),j.lineTo(-w.x,-w.y),j.stroke(),s.is&&(j.strokeStyle="rgba(50, 255, 0, 0.4)",j.beginPath(),j.lineWidth=30,j.lineCap="round",j.moveTo(s.sx,s.sy),j.lineTo(s.x,s.y),j.stroke())})(e)})}else e.health<1?(b++,M.die.play(),X.gameover(),V()):(M.hit.play(),X.hit())},W=()=>{(i=new WebSocket("ws://kraftwerk28.pp.ua:8090")).onmessage=(e=>{const t=JSON.parse(e.data);H(t)}),i.onopen=(e=>{i.send(JSON.stringify({nickname:a.nickname})),setInterval(()=>{u=Date.now(),i.send('"p"')},1e3)}),i.onclose=(e=>{console.log("Connection closed. Code: "+e.code),1006===e.code&&setTimeout(()=>{W()},500)}),i.onerror=(e=>{console.warn(e)})},Y=e=>{i.send(`{"upgrade":${e}}`)},K=e=>{d&&M.shoot.play();const t=()=>{setTimeout(()=>{d&&(M.shoot.play(),t())},f)};t(),i.send(`{"shoot":${e?1:0}}`)},Q=e=>{e?M.speedup.play():(M.speedup.pause(),M.speedup.currentTime=0),a.speed=Number(e),i.send(JSON.stringify({speedup:e}))},U=(e,t)=>e+.2*(t-e),V=()=>{o("kills").textContent=`kills: ${S||0}`,o("deaths").textContent=`deaths: ${b||0}`},Z=e=>{Array.prototype.forEach.call(I.children,e=>{e.style.display="none"});let t=0;for(;t<e;)I.children[t].style.display="inline",t++},ee=()=>{document.body.webkitRequestFullScreen()};E.focus()}]);